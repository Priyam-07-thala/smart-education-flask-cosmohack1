<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg: #f5f7fb;
            --card: #ffffff;
            --text: #111827;
            --primary: #2563eb;
        }

        body.dark {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #e5e7eb;
            --primary: #60a5fa;
        }

       body {
    background:
        linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)),
        url("{{ url_for('static', filename='images/student_bg.jpg') }}");
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
}

        .navbar {
            background: var(--card);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.13);
            background-color: #2563eb;
        }

        .nav-actions button,
        .nav-actions a {
            padding: 8px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
        }

        .container {
            max-width: 1000px;
            margin: 40px auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: var(--card);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            background-color: white;
        }

        .risk {
            /* ALERT BOX */
.alert {
    margin-top: 15px;
    padding: 12px 16px;
    border-radius: 8px;
    font-weight: bold;
}

.alert.Low {
    background: #dcfce7;
    color: #166534;
    border-left: 6px solid #22c55e;
}

.alert.Medium {
    background: #fef3c7;
    color: #92400e;
    border-left: 6px solid #f59e0b;
}

.alert.High {
    background: #fee2e2;
    color: #991b1b;
    border-left: 6px solid #ef4444;
}

        }

        .risk.Low { background: #22c55e; }
        .risk.Medium { background: #f59e0b; }
        .risk.High { background: #ef4444; }

        /* IMPORTANT */
        canvas {
            max-height: 300px;
        }
    </style>
</head>

<body>

<div class="navbar">
    <h2>Smart Education</h2>
    <div class="nav-actions">
        <button onclick="toggleTheme()">üåô</button>
        <a href="/logout">Logout</a>
    </div>
</div>

<div class="container">

    <div class="card">
        <h3>Student Details</h3>
        <p><b>ID:</b> {{ student["student_id"] }}</p>
        <p><b>Name:</b> {{ student["name"] }}</p>
        <div class="alert {{ risk }}">
    {% if risk == "High" %}
        ‚ö†Ô∏è High Risk Detected! Immediate attention required.
    {% elif risk == "Medium" %}
        ‚ö†Ô∏è Medium Risk. Monitor progress closely.
    {% else %}
        ‚úÖ Low Risk. Student is performing well.
    {% endif %}
</div>

    </div>

    <div class="card">
        <h3>Performance Chart</h3>
        <canvas id="performanceChart"></canvas>
    </div>

</div>

<!-- PASS DATA SAFELY -->
<script type="application/json" id="chart-data">
{{ chart_data | tojson }}
</script>

<script>
    // Theme
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
    }

    function toggleTheme() {
        document.body.classList.toggle("dark");
        localStorage.setItem(
            "theme",
            document.body.classList.contains("dark") ? "dark" : "light"
        );
    }

    // Read data safely
    const chartData = JSON.parse(
        document.getElementById("chart-data").textContent
    );

    console.log("Chart Data:", chartData); // should show all 4 values

    const ctx = document
        .getElementById("performanceChart")
        .getContext("2d");

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Attendance", "Marks", "Assignments", "Behavior"],
            datasets: [{
                label: "Student Performance",
                data: [
                    Number(chartData.attendance),
                    Number(chartData.marks),
                    Number(chartData.assignments),
                    Number(chartData.behavior)
                ],
                backgroundColor: "#2563eb"
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
</script>


</body>
</html>
